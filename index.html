<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‰²å¼±éŠæˆ²</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
    }

    header {
      height: 100vh;
      background-color: lightcoral;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-1 {
      width: 500px;
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .rule {
      width: 400px;
      height: 250px;
      background-color: aliceblue;
      opacity: 80%;
      border-radius: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
    }

    #start {
      width: 200px;
      height: 50px;
      border-radius: 30px;
      border: 2px solid darkslategrey;
      font-size: 20px;
      background-color: bisque;
    }

    li {
      list-style: none;
    }

    main {
      height: 100vh;
      background-color: khaki;
      display: flex;
      align-items: center;
      justify-content: center;
      display: none;
    }

    .page-2 {
      width: 500px;
      height: 700px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .consent {
      width: 500px;
      height: 500px;
      display: flex;
      align-items: center;
    }

    #box {
      width: 100%;
      height: 100%;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    #box>div {
      /* width: 100px;
      height: 100px; */
      border-radius: 20px;
      /* margin: 5px; */
      border: 5px solid khaki;
      /* background-color: olive; */
    }

    .ansbox {
      opacity: 60%;
    }

    .last {
      margin-top: -30px;
      width: 400px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: space-around;
      opacity: 90%;
    }

    #time-box {
      width: 120px;
      height: 60px;
      background-color: white;
      border-radius: 20px;
      text-align: center;
      line-height: 60px;
      font-size: 18px;
      /* border: 2px solid darkolivegreen; */
    }

    .score {
      margin-top: -30px;
      width: 200px;
      height: 80px;
      border-radius: 20px;
      background-color: white;
      opacity: 90%;
      text-align: center;
      font-size: 28px;
      line-height: 90px;
    }

    #stop {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background-color: white;
      border: none;
      text-align: center;
      line-height: 65px;
      font-size: 18px;
    }

    #sos {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background-color: white;
      border: none;
      text-align: center;
      line-height: 66px;
      font-size: 18px;
    }

    footer {
      height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: dimgray;
      display: none;
    }

    .page-3 {
      width: 400px;
      height: 500px;
      /* background-color: whitesmoke; */
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .endding {
      width: 400px;
      height: 300px;
      background-color: whitesmoke;
      border-radius: 30px;
      text-align: center;
      line-height: 100px;
      opacity: 80%;
    }

    #again {
      width: 150px;
      height: 40px;
      font-size: 20px;
      border-radius: 30px;
    }

    .act {
      display: flex;
    }

    .no-act {
      display: none;
    }

    .endding p {
      font-size: 18px;
    }
  </style>
</head>

<body>
  <header>
    <div class="page-1">
      <div class="rule">
        <h1>è‰²å¼±éŠæˆ²</h1>
        <li>é»æ“Š Start game é–‹å§‹éŠæˆ²</li>
        <li>æ™‚é–“è¨ˆæ™‚ 30 ç§’ å¾Œå³çµæŸéŠæˆ²</li>
        <li>æ¸¬è©¦è‡ªå·±è¾¨è­˜é¡è‰²çš„èƒ½åŠ›</li>
        <br>
        <li>ğŸŒŸå°æé†’ğŸŒŸ</li>
        <li>é»éŒ¯è‰²å¡Šæˆ–è€…é»æ“Šæç¤ºéƒ½æœƒæ‰£åˆ†</li>
      </div>
      <button id="start">Start game</button>
    </div>
  </header>
  <main>
    <div class="page-2">
      <div class="score">score: 40</div>
      <div class="consent">
        <div id="box" class="randombox"></div>
        <div class="randombox ansbox"></div>
      </div>
      <div class="last">
        <div id="time-box">times up</div>
        <button id="stop">Stop</button>
        <button id="sos">SOS</button>
      </div>
    </div>
  </main>
  <footer>
    <div class="page-3">
      <div class="endding">
        <p>æ­å–œæ‚¨ç²å¾—äº† åˆ†</p>
        <h1>æ­å–œä½ ï¼Œè‰¾å€«è‘‰å¡</h1>
      </div>
      <button id="again">Play again</button>
    </div>
  </footer>

  <script>
    const time_box = document.querySelector('#time-box')
    const start = document.querySelector('#start')
    const score = document.querySelector('.score')
    const page1 = document.querySelector('header')
    const page2 = document.querySelector('main')
    const page3 = document.querySelector('footer')

    const stop = document.getElementById('stop')
    const sos = document.getElementById('sos')
    const box = document.querySelector('#box')
    const ending = document.querySelector('.endding')
    const again = document.querySelector('#again')

    var startScore = 40;
    var opacity = 0.6

    start.onclick = function () {
      var timeSecond = 30;

      page3.classList.remove('no-act')
      page1.classList.remove('act')
      page1.classList.add('no-act')
      page2.classList.add('act')

      // æŒ‰ä¸‹é–‹å§‹éµï¼Œå€’æ•¸è¨ˆæ™‚å¾ 30 ç§’é–‹å§‹
      time_box.innerHTML = 'å€’æ•¸' + timeSecond + 'ç§’'
      // è³¦äºˆèµ·å§‹å€¼ç‚º 40 åˆ†
      score.innerHTML = 'score: ' + startScore

      var level = 2
      var num = Math.floor(Math.random() * (level * level))
      // äº‚æ•¸æ±ºå®šé¡è‰²
      let r = Math.floor(Math.random() * 200)
      let g = Math.floor(Math.random() * 200)
      let b = Math.floor(Math.random() * 200)

      // æ­¤è¿´åœˆä»£è¡¨ç”Ÿæˆæ–¹å¡Š
      for (let i = 0; i < level * level; i++) {
        if (i == num) {
          box.innerHTML = box.innerHTML + `<div onclick="checkAnswer(true)" class="randombox" style="width:${100 / level}% ; height:${100 / level}%; background-color: rgb(${r}, ${g}, ${b}); opacity:${opacity};"></div>`
        } else {
          box.innerHTML = box.innerHTML + `<div onclick="checkAnswer(false)" class="randombox" style="width:${100 / level}% ; height:${100 / level}%; background-color: rgb(${r}, ${g}, ${b});"></div>`
        }
      }

      // è¨­å®šå€’æ•¸è¨ˆæ™‚
      var ntimeCountDow = setInterval(function () {
        timeSecond = timeSecond - 1
        time_box.innerHTML = `å€’æ•¸ ${timeSecond} ç§’`

        if (timeSecond == 0) {
          // é‡ç½®è¨ˆæ™‚å™¨
          page2.classList.remove('act')
          page2.classList.add('no-act')
          page2.classList.remove('no-act')
          page3.classList.add('act')

          clearInterval(ntimeCountDow)

          console.log(startScore);
          if (startScore >= 120) {
            ending.innerHTML = `
            <p>æ­å–œæ‚¨ç²å¾—äº† ${startScore} åˆ†</p> 
            <h1>æ­å–œä½ ï¼Œè‰¾å€«è‘‰å¡</h1>`
          } else if (startScore >= 100 && startScore < 120) {
            ending.innerHTML = `
            <p>æ­å–œæ‚¨ç²å¾—äº† ${startScore} åˆ†</p> 
            <h1>æ‚¨é›¢ç¥å°±å·®ä¸€æ­¥ä¹‹é™</h1>`
          } else if (startScore >= 80 && startScore < 100) {
            ending.innerHTML = `
            <p>æ­å–œæ‚¨ç²å¾—äº† ${startScore} åˆ†</p> 
            <h1>å† try tryï¼Œç›¸ä¿¡æ‚¨å¯ä»¥çš„</h1>`
          } else {
            ending.innerHTML = `
            <p>æ­å–œæ‚¨ç²å¾—äº† ${startScore} åˆ†</p> 
            <h1>æ‚¨æœƒæ‰¾åˆ°æ›´å¥½çš„å‡ºè·¯</h1>`
          }

          // æ¸…ç©ºæ–¹å¡Š
          box.innerHTML = ''
        }
      }, 1000)

      // è¨­å®šæš«åœåŠŸèƒ½
      stop.onclick = function () {
        alert('ä¸è¨±å£å£ï¼')
      }

      // HINT
      sos.onclick = function () {
        startScore = startScore - 5
        score.innerHTML = 'score: ' + startScore
        // é¸å–åˆ°æ­£ç¢ºç­”æ¡ˆçš„æ¡†æ¡†
        const ansbox = document.querySelector('.randombox.answer')
        // å°‡æ­£ç¢ºç­”æ¡ˆçš„æ¡†æ¡†åŠ ä¸Šcsså±¬æ€§è®Šå¾—æ›´é¡¯çœ¼
        ansbox.classList.add('act')
      }

    }

    function checkAnswer(guess) {
      if (guess) {
        startScore = startScore + 3
        score.innerHTML = 'score: ' + startScore
        // æ¸…ç©ºæ ¼å­
        box.innerHTML = ''

        var level = 2
        var num = Math.floor(Math.random() * (level * level))

        // ç•¶ä½  50 ~ 59 åˆ†æ™‚æœƒç”Ÿæˆ 3x3 çš„æ–¹å¡Š
        if (startScore >= 50 && startScore < 65) {
          level = 3
          opacity = 0.6

          // ç•¶ä½  60 ~ 69 åˆ†æ™‚æœƒç”Ÿæˆ 4x4 çš„æ–¹å¡Š
        } else if (65 <= startScore && startScore < 80) {
          level = 4
          opacity = 0.7
        } else if (80 <= startScore && startScore < 90) {
          level = 5
          opacity = 0.8
        } else if (90 <= startScore && startScore < 105) {
          level = 6
          opacity = 0.85
        } else if (105 <= startScore) {
          level = 7
          opacity = 0.9
        }

        num = Math.floor(Math.random() * (level * level))

        let r = Math.floor(Math.random() * 200)
        let g = Math.floor(Math.random() * 200)
        let b = Math.floor(Math.random() * 200)
        // æ­¤è¿´åœˆä»£è¡¨ç”Ÿæˆæ–¹å¡Š
        for (let i = 0; i < level * level; i++) {
          if (i == num) {
            box.innerHTML = box.innerHTML + `<div onclick="checkAnswer(true)" class="randombox" style="width:${100 / level}% ; height:${100 / level}%; background-color: rgb(${r}, ${g}, ${b}); opacity:${opacity};"></div>`
          } else {
            box.innerHTML = box.innerHTML + `<div onclick="checkAnswer(false)" class="randombox" style="width:${100 / level}% ; height:${100 / level}%; background-color: rgb(${r}, ${g}, ${b});"></div>`
          }
        }
      } else {
        score.innerHTML = 'score: ' + (startScore - 5);
      }
    }

    // å†ç©ä¸€æ¬¡æŒ‰éˆ•
    again.onclick = function () {
      page3.classList.remove('act')
      page3.classList.add('no-act')
      page1.classList.remove('no-act')
      page1.classList.add('act')

      // æ¸…ç©ºåˆ†æ•¸
      startScore = 40;
    }

  </script>
</body>

</html>